 #缓存
 原文:https://blog.csdn.net/qq_26517369/article/details/78330694
 
 1. 原理
 * 将数据写入/读取速度更快的存储（设备）；
 * 将数据缓存到离应用最近的距离
 * 将数据缓存到用户最近的位置
 
 2.  缓存分类
 *  cdn缓存
 * 反向代理缓存
 * 分布式缓存
 * 本地应用缓存
 
 3.  缓存媒介
 * 常用中间件：ngnix，redis，squid
 
 * 缓存内容:文件，数据，对象
 
 *  缓存介质：cpu，内存（本地，分布式），磁盘（本地，分布式）
 
 4.  缓存设计
  缓存什么，什么数据需要缓存:
       1. 热点数据 
       2. 静态数据
  
   缓存位置：cdn,反向代理，分布式缓存服务器，本机（内存，硬盘)
  
   如何缓存：
  *  过期策略
  *  固定时间
  *  相对时间
  *  同步机制
  *  实时写入
  *  异步刷新
  
  
  ## cdn缓存
  主要解决 将数据缓存到离用户最近的位置，一般缓存静态资源（页面，脚本，图片，文件等）。
  
原理:
  
  广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的网络中，在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，缓存服务器直接响应用户请求
  
  
  未部署CDN应用前网络请求路径：
 *  请求：本机网络（局域网）——》运营商网络——》应用服务器机房
  
  * 响应：应用服务器机房——》运营商网络——》本机网络（局域网）
  
  部署CDN应用后网络路径：
  *    请求：本机网络（局域网）——》运营商网络
  *    响应：运营商网络——》本机网络（局域网）
  
  优点：
  
  本地cache加速：提升访问速度
  
  镜像服务 ：消除了不同运营商之间互联的瓶颈造成的影响，实现了跨运营商的网络加速，保证网络的用户都能得到良好的访问质量。
  
 远程加速：远程访问用户根据DNS负载均衡技术智能自动选择Cache服务器，选择最快的Cache服务器，加快远程访问的速度。
  
  带宽优化：自动生成服务器的远程Mirror（镜像）cache服务器，远程用户访问时从cache服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点WEB服务器负载等功能。
  
  集群抗攻击：广泛分布的CDN节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵以及降低各种D.D.o.S攻击对网站的影响，同时保证较好的服务质量。
  
  缺点:
  
  * 动态资源缓存，不能保证实时性（尽量缓存静态资源，动态资源建立多级缓存或准实时同步）
  * 很难保证数据的一致性和实时性（设置缓存失效时间（1小时，最终一致性）；数据版本号）；
  
  ## 反向代理缓存
  反向代理缓存是指在网站服务器机房部署代理服务器，实现负载均衡，数据缓存，安全控制等
  
  原理
  
  位于应用服务器机房，处理所有对web服务器的请求当用户请求的页面在代理服务器上有缓存，代理服务器直接将缓存内容发送到用户，如果没有缓冲则先向web服务器发出请求，取回数据，本地缓存后再发送给用户，通过降低web服务器的请求数，从而降低web服务器的负载
  
  反向代理一般缓存静态资源，动态资源转发到应用服务器处理，常用的缓存应用服务器有
 ngnix
 
 ## 分布式缓存
 
 主要指缓存用户经常访问数据的缓存，数据源为数据库，一般起到热点数据访问和减轻数据库压力的作用。
 
 redis
 
  Redis 是一个开源（BSD许可）的，基于内存的，多数据结构存储系统。可以用作数据库、缓存和消息中间件。 支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。
  
内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动分区（Cluster）提供高可用性（high availability）。

##  本地缓存

硬盘缓存

将数据缓存到硬盘，读取时从硬盘读取

原理：

直接读取本机文件，减少了网络传输消耗，比通过网络读取数据库速度快，可以应用到速度要求不高但需要大量缓存存储的地方。


内存缓存
直接将数据存储在本机，通过程序维护缓存对象，是访问速度最快的方式


##   缓存架构

职责划分：

CDN：存放HTML、CSS、JS等静态资源；

反向代理：动静分离，只缓存用户请求的静态资源；

分布式缓存：缓存数据库中的热点数据；

本地缓存：缓存应用字典等常用数据。

请求过程：

（1）浏览器向客户端发起请求，如果CDN有缓存则直接返回；

（2）如果CDN无缓存，则访问反向代理服务器；

（3）如果反向代理服务器有缓存则直接返回；

（4）如果反向代理服务器无缓存或动态请求，则访问应用服务器；

（5）应用服务器访问本地缓存；如果有缓存，则返回代理服务器，并缓存数据；（动态请求不缓存）

（6）如果本地缓存无数据，则读取分布式缓存；并返回应用服务器；应用服务器将数据缓存到本地缓存（部分）；

（7）如果分布式缓存无数据，则应用程序读取数据库数据，并放入分布式缓存