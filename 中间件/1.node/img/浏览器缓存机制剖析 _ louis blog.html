<!DOCTYPE html>
<!-- saved from url=(0049)http://louiszhai.github.io/2017/04/07/http-cache/ -->
<html class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>浏览器缓存机制剖析 | louis blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="http-cache 浏览器缓存策略 浏览器缓存机制 304协商缓存 强缓存 Age Date Vary Cache-Control Expires ETag Last-Modified Pragma If-Modified-Since If-Unmodified-Since If-Match If-None-Match no-cache max-age max-stale min-fresh m">
<meta name="keywords" content="Web">
<meta property="og:type" content="article">
<meta property="og:title" content="浏览器缓存机制剖析">
<meta property="og:url" content="http://louiszhai.github.io/2017/04/07/http-cache/index.html">
<meta property="og:site_name" content="louis blog">
<meta property="og:description" content="http-cache 浏览器缓存策略 浏览器缓存机制 304协商缓存 强缓存 Age Date Vary Cache-Control Expires ETag Last-Modified Pragma If-Modified-Since If-Unmodified-Since If-Match If-None-Match no-cache max-age max-stale min-fresh m">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache03.png">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache06.png">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache07.png">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache08.png">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache01.png">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache02.png">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache04.png">
<meta property="og:image" content="http://louiszhai.github.io/docImages/http-cache05.png">
<meta property="og:updated_time" content="2018-03-27T11:13:22.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="浏览器缓存机制剖析">
<meta name="twitter:description" content="http-cache 浏览器缓存策略 浏览器缓存机制 304协商缓存 强缓存 Age Date Vary Cache-Control Expires ETag Last-Modified Pragma If-Modified-Since If-Unmodified-Since If-Match If-None-Match no-cache max-age max-stale min-fresh m">
<meta name="twitter:image" content="http://louiszhai.github.io/docImages/http-cache03.png">
  
    <link rel="alternative" href="http://louiszhai.github.io/atom.xml" title="louis blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="http://louiszhai.github.io/favicon.ico">
  
  <link rel="stylesheet" href="./浏览器缓存机制剖析 _ louis blog_files/style.css">
<script type="text/javascript" async="" charset="utf-8" src="./浏览器缓存机制剖析 _ louis blog_files/core.php"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="/js/mobile.js" src="./浏览器缓存机制剖析 _ louis blog_files/mobile.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="/fancybox/jquery.fancybox.js" src="./浏览器缓存机制剖析 _ louis blog_files/jquery.fancybox.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="/js/jquery.lazyload.js" src="./浏览器缓存机制剖析 _ louis blog_files/jquery.lazyload.js.下载"></script><style type="text/css">.fancybox-margin{margin-right:10px;}</style></head>

<body>
<div id="container" class="toc-fixed">
    <div class="left-col">
        <div class="overlay">
	<!--<input type="text" class="st-default-search-input" style="position:absolute;top: 50px;left: 35px;">-->
</div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="http://louiszhai.github.io/" class="profilepic">
			
			<img lazy-src="https://avatars2.githubusercontent.com/u/8412301?v=3&amp;s=320" class="js-avatar show" src="./浏览器缓存机制剖析 _ louis blog_files/8412301">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="http://louiszhai.github.io/">路易斯</a></h1>
		</hgroup>

		
		<p class="header-subtitle">坚持原著, 深度思考, 力求简单通俗叙事</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="http://louiszhai.github.io/">主页</a></li>
				        
							<li><a href="http://louiszhai.github.io/archives/">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Louiszhai" title="github">github</a>
					        
								<a class="rss" target="_blank" href="http://louiszhai.github.io/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="http://louiszhai.github.io/tags/CSS/" style="font-size: 12px;" class="color4">CSS</a> <a href="http://louiszhai.github.io/tags/JavaScript/" style="font-size: 12px;" class="color1">JavaScript</a> <a href="http://louiszhai.github.io/tags/JavaScript-Canvas/" style="font-size: 12px;" class="color3">JavaScript Canvas</a> <a href="http://louiszhai.github.io/tags/JavaScript-Chrome-Extension/" style="font-size: 12px;" class="color3">JavaScript Chrome-Extension</a> <a href="http://louiszhai.github.io/tags/Tool/" style="font-size: 12px;" class="color5">Tool</a> <a href="http://louiszhai.github.io/tags/Web/" style="font-size: 12px;" class="color4">Web</a> <a href="http://louiszhai.github.io/tags/XSS/" style="font-size: 12px;" class="color4">XSS</a> <a href="http://louiszhai.github.io/tags/css/" style="font-size: 12px;" class="color4">css</a> <a href="http://louiszhai.github.io/tags/javascript/" style="font-size: 12px;" class="color1">javascript</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.zhangxinxu.com/wordpress/category/js/">张鑫旭-鑫空间-鑫生活</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://evanyou.me/">尤雨溪主页</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
        <nav id="mobile-nav">
  	<div class="overlay fixed">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header fixed">路易斯</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://avatars2.githubusercontent.com/u/8412301?v=3&amp;s=320" class="js-avatar show" src="./浏览器缓存机制剖析 _ louis blog_files/8412301">
			
			</div>
			<hgroup>
			  <h1 class="header-author">路易斯</h1>
			</hgroup>
			
			<p class="header-subtitle">坚持原著, 深度思考, 力求简单通俗叙事</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="http://louiszhai.github.io/">主页</a></li>
		        
					<li><a href="http://louiszhai.github.io/archives/">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Louiszhai" title="github">github</a>
			        
						<a class="rss" target="_blank" href="http://louiszhai.github.io/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

        <div class="body-wrap"><article id="post-http-cache" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="http://louiszhai.github.io/2017/04/07/http-cache/" class="article-date">
  	<time datetime="2017-04-07T00:00:00.000Z" itemprop="datePublished">2017-04-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      浏览器缓存机制剖析
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="color4" href="http://louiszhai.github.io/tags/Web/" style="font-size: 12px;">Web</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody" style="padding-top: 0px;">
      
          <span class="toc-arrow"></span>
<div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#%E5%AF%BC%E8%AF%BB"><span class="toc-text">导读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#Cache-Control"><span class="toc-text">Cache-Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#Pragma"><span class="toc-text">Pragma</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#Expires"><span class="toc-text">Expires</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#ETag"><span class="toc-text">ETag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#If-Match"><span class="toc-text">If-Match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#If-None-Match"><span class="toc-text">If-None-Match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#Last-Modified"><span class="toc-text">Last-Modified</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#If-Modified-Since"><span class="toc-text">If-Modified-Since</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#If-Unmodified-Since"><span class="toc-text">If-Unmodified-Since</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#%E5%BC%BA%E7%BC%93%E5%AD%98"><span class="toc-text">强缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98"><span class="toc-text">协商缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#Age"><span class="toc-text">Age</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#Date"><span class="toc-text">Date</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#Vary"><span class="toc-text">Vary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#%E6%80%8E%E4%B9%88%E8%AE%A9%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E7%BC%93%E5%AD%98%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-text">怎么让浏览器不缓存静态资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/04/07/http-cache/#IE8%E7%9A%84%E5%BC%82%E5%B8%B8%E8%A1%A8%E7%8E%B0"><span class="toc-text">IE8的异常表现</span></a></li></ol>
</div>
      
        <p>缓存一直是前端优化的主战场, 利用好缓存就成功了一半. 本篇从http请求和响应的头域入手, 让你对浏览器缓存有个整体的概念. 最终你会发现强缓存, 协商缓存 和 启发式缓存是如此的简单.</p>
<h3 id="导读"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#%E5%AF%BC%E8%AF%BB" class="headerlink" title="导读"></a><strong>导读</strong></h3><p>我不知道拖延症是有多严重, 反正去年3月开的题, 直到今年4月才开始写.(请尽情吐槽吧)</p>
<a id="more"></a>
<p>浏览器对于请求资源, 拥有一系列成熟的缓存策略. 按照发生的时间顺序分别为<strong>存储策略</strong>, <strong>过期策略</strong>, <strong>协商策略</strong>, 其中<strong>存储策略</strong>在收到响应后应用, <strong>过期策略</strong>, <strong>协商策略</strong>在发送请求前应用. 流程图如下所示.</p>
<div id="flowchart-0" class="flow-chart"><svg height="526.9453125" version="1.1" width="1362.375" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; top: -0.78125px;" viewBox="0 0 1362.375 526.9453125" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock33-objt6zqq" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objschkp" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objzinlv" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objdcaay" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objgk6y1" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objxc6w9" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objheto4" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objx2r0h" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objkdwfw" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj9bukx" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objiyx5b" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj4rqje" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="68" height="34" rx="20" ry="20" fill="#b5ca92" stroke="#008000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="1" class="flowchart" id="st" transform="matrix(1,0,0,1,52,25.875)"></rect><text x="10" y="17" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,52,25.875)" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">发起请求</tspan></text><path fill="#58c4a3" stroke="#000000" d="M36.375,18.1875L0,36.375L72.75,72.75L145.5,36.375L72.75,0L0,36.375" stroke-width="1" id="c1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,13.25,116.375)"></path><text x="41.375" y="36.375" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="c1t" class="flowchartt" transform="matrix(1,0,0,1,13.25,116.375)" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">是否已缓存?</tspan></text><path fill="#58c4a3" stroke="#000000" d="M40.875,20.4375L0,40.875L81.75,81.75L163.5,40.875L81.75,0L0,40.875" stroke-width="1" id="c2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,213,111.875)"></path><text x="45.875" y="40.875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="c2t" class="flowchartt" transform="matrix(1,0,0,1,213,111.875)" stroke-width="1"><tspan dy="-3.1953125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">[过期策略]-</tspan><tspan dy="14.399999999999999" x="45.875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">缓存是否过期?</tspan></text><rect x="0" y="0" width="140" height="48.390625" rx="0" ry="0" fill="#f1d5a6" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="1" class="flowchart" id="op1" transform="matrix(1,0,0,1,442.5,128.5547)"></rect><text x="10" y="24.1953125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,442.5,128.5547)" stroke-width="1"><tspan dy="-3.1875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">[协商策略]-</tspan><tspan dy="14.399999999999999" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">重新向服务器发起验证</tspan></text><path fill="#58c4a3" stroke="#000000" d="M40.875,20.4375L0,40.875L81.75,81.75L163.5,40.875L81.75,0L0,40.875" stroke-width="1" id="c3" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,636.75,111.875)"></path><text x="45.875" y="40.875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="c3t" class="flowchartt" transform="matrix(1,0,0,1,636.75,111.875)" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">验证是否通过?</tspan></text><rect x="0" y="0" width="64.015625" height="34" rx="0" ry="0" fill="#f1d5a6" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="1" class="flowchart" id="op3" transform="matrix(1,0,0,1,904.2422,135.75)"></rect><text x="10" y="17" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="op3t" class="flowchartt" transform="matrix(1,0,0,1,904.2422,135.75)" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">304响应</tspan></text><path fill="#c59e63" stroke="#000000" d="M10,24.1953125L0,48.390625L148,48.390625L168,0L20,0L10,24.1953125" stroke-width="1" id="io2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,852.25,238.4297)"></path><text x="30" y="24.1953125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="io2t" class="flowchartt" transform="matrix(1,0,0,1,852.25,238.4297)" stroke-width="1"><tspan dy="-3.1875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">[存储策略]-</tspan><tspan dy="14.399999999999999" x="30" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">根据响应头更新缓存</tspan><tspan dy="14.399999999999999" x="30" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></tspan></text><rect x="0" y="0" width="68" height="34" rx="20" ry="20" fill="#92a8cd" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="1" class="flowchart" id="e" transform="matrix(1,0,0,1,52,491.9453)"></rect><text x="10" y="17" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,52,491.9453)" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">载入资源</tspan></text><rect x="0" y="0" width="116" height="34" rx="0" ry="0" fill="#f1d5a6" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="1" class="flowchart" id="op2" transform="matrix(1,0,0,1,28,265)"></rect><text x="10" y="17" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,28,265)" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">向服务器请求资源</tspan></text><path fill="#c59e63" stroke="#000000" d="M10,24.1953125L0,48.390625L136,48.390625L156,0L20,0L10,24.1953125" stroke-width="1" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,8,367.6797)"></path><text x="30" y="24.1953125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,8,367.6797)" stroke-width="1"><tspan dy="-3.1875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">[存储策略]-</tspan><tspan dy="14.399999999999999" x="30" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">响应内容存入缓存</tspan></text><path fill="none" stroke="#000000" d="M86,59.875C86,59.875,86,105.92847073078156,86,114.8783151403768" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objt6zqq)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M158.75,152.75C158.75,152.75,202.73065280914307,152.75,211.49242348596454,152.75" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objschkp)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="163.75" y="142.75" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">是</tspan></text><path fill="none" stroke="#000000" d="M86,189.125C86,189.125,86,252.85843774676323,86,263.5014239329903" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objzinlv)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="91" y="199.125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">否</tspan></text><path fill="none" stroke="#000000" d="M376.5,152.75C376.5,152.75,431.1733703613281,152.75,440.9974915981293,152.75" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objdcaay)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="381.5" y="142.75" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">是</tspan></text><path fill="none" stroke="#000000" d="M294.75,193.625C294.75,193.625,294.75,466.9453125,294.75,466.9453125C294.75,466.9453125,86,466.9453125,86,466.9453125C86,466.9453125,86,485.03272342681885,86,490.43775052018464" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objgk6y1)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="299.75" y="203.625" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">否</tspan></text><path fill="none" stroke="#000000" d="M582.5,152.75C582.5,152.75,626.4806528091431,152.75,635.2424234859645,152.75" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objxc6w9)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M800.25,152.75C800.25,152.75,889.9908420103602,152.75,902.7421042296057,152.75" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objheto4)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="805.25" y="142.75" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">是</tspan></text><path fill="none" stroke="#000000" d="M718.5,193.625C718.5,193.625,718.5,240,718.5,240C718.5,240,296.75,240,296.75,240C296.75,240,294.75,236,292.75,240C292.75,240,86,240,86,240C86,240,86,258.08741092681885,86,263.49243802018464" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objx2r0h)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="723.5" y="203.625" text-anchor="start" font-family="&quot;Arial&quot;" font-size="12px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 12px;" stroke-width="1"><tspan dy="4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">否</tspan></text><path fill="none" stroke="#000000" d="M936.25,169.75C936.25,169.75,936.25,226.88762041926384,936.25,236.93134275858756" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objkdwfw)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M936.25,286.8203125C936.25,286.8203125,936.25,466.9453125,936.25,466.9453125C936.25,466.9453125,86,466.9453125,86,466.9453125C86,466.9453125,86,485.03272342681885,86,490.43775052018464" stroke-width="1" marker-end="url(#raphael-marker-endblock33-obj9bukx)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M86,299C86,299,86,356.13762041926384,86,366.18134275858756" stroke-width="1" marker-end="url(#raphael-marker-endblock33-objiyx5b)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M86,416.0703125C86,416.0703125,86,479.80375024676323,86,490.4467364329903" stroke-width="1" marker-end="url(#raphael-marker-endblock33-obj4rqje)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg></div>

<p>废话不多说, 我们先来看两张表格.</p>
<p>1.http header中与缓存有关的key.</p>
<table>
<thead>
<tr>
<th style="text-align:center">key</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">存储策略</th>
<th style="text-align:center">过期策略</th>
<th style="text-align:center">协商策略</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Cache-Control</strong></td>
<td style="text-align:center">指定缓存机制,覆盖其它设置</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><strong>Pragma</strong></td>
<td style="text-align:center">http1.0字段,指定缓存机制</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><strong>Expires</strong></td>
<td style="text-align:center">http1.0字段,指定缓存的过期时间</td>
<td style="text-align:center"></td>
<td style="text-align:center">✔️</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><strong>Last-Modified</strong></td>
<td style="text-align:center">资源最后一次的修改时间</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>ETag</strong></td>
<td style="text-align:center">唯一标识请求资源的字符串</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">✔️</td>
</tr>
</tbody>
</table>
<p>2.缓存协商策略用于重新验证缓存资源是否有效, 有关的key如下.</p>
<table>
<thead>
<tr>
<th style="text-align:center">key</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>If-Modified-Since</strong></td>
<td style="text-align:center">缓存校验字段, 值为资源最后一次的修改时间, 即上次收到的Last-Modified值</td>
</tr>
<tr>
<td style="text-align:center"><strong>If-Unmodified-Since</strong></td>
<td style="text-align:center">同上, 处理方式与之相反</td>
</tr>
<tr>
<td style="text-align:center"><strong>If-Match</strong></td>
<td style="text-align:center">缓存校验字段, 值为唯一标识请求资源的字符串, 即上次收到的ETag值</td>
</tr>
<tr>
<td style="text-align:center"><strong>If-None-Match</strong></td>
<td style="text-align:center">同上, 处理方式与之相反</td>
</tr>
</tbody>
</table>
<p>下面我们来看下各个头域(key)的作用.</p>
<h3 id="Cache-Control"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#Cache-Control" class="headerlink" title="Cache-Control"></a><strong>Cache-Control</strong></h3><p>浏览器缓存里, Cache-Control是金字塔顶尖的规则, 它藐视一切其他设置, 只要其他设置与其抵触, 一律覆盖之.</p>
<p>不仅如此, 它还是一个复合规则, 包含多种值, 横跨 <strong>存储策略</strong>, <strong>过期策略</strong> 两种, 同时在请求头和响应头都可设置.</p>
<p>语法为: <em>“Cache-Control : cache-directive”</em>.</p>
<p>Cache-directive共有如下12种(其中请求中指令7种, 响应中指令9种):</p>
<table>
<thead>
<tr>
<th style="text-align:center">Cache-directive</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">存储策略</th>
<th style="text-align:center">过期策略</th>
<th>请求字段</th>
<th>响应字段</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>public</strong></td>
<td style="text-align:center">资源将被客户端和代理服务器缓存</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center"></td>
<td></td>
<td>✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>private</strong></td>
<td style="text-align:center">资源仅被客户端缓存, 代理服务器不缓存</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center"></td>
<td></td>
<td>✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>no-store</strong></td>
<td style="text-align:center">请求和响应都不缓存</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center"></td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>no-cache</strong></td>
<td style="text-align:center">相当于<code>max-age:0,must-revalidate</code>即资源被缓存, 但是缓存立刻过期, 同时下次访问时强制验证资源有效性</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>max-age</strong></td>
<td style="text-align:center">缓存资源, 但是在指定时间(单位为秒)后缓存过期</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>s-maxage</strong></td>
<td style="text-align:center">同上, 依赖public设置, 覆盖max-age, 且只在代理服务器上有效.</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td></td>
<td>✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>max-stale</strong></td>
<td style="text-align:center">指定时间内, 即使缓存过时, 资源依然有效</td>
<td style="text-align:center"></td>
<td style="text-align:center">✔️</td>
<td>✔️</td>
<td></td>
</tr>
<tr>
<td style="text-align:center"><strong>min-fresh</strong></td>
<td style="text-align:center">缓存的资源至少要保持指定时间的新鲜期</td>
<td style="text-align:center"></td>
<td style="text-align:center">✔️</td>
<td>✔️</td>
<td></td>
</tr>
<tr>
<td style="text-align:center"><strong>must-revalidation</strong> / <strong>proxy-revalidation</strong></td>
<td style="text-align:center">如果缓存失效, 强制重新向服务器(或代理)发起验证(因为max-stale等字段可能改变缓存的失效时间)</td>
<td style="text-align:center"></td>
<td style="text-align:center">✔️</td>
<td></td>
<td>✔️</td>
</tr>
<tr>
<td style="text-align:center"><strong>only-if-cached</strong></td>
<td style="text-align:center">仅仅返回已经缓存的资源, 不访问网络, 若无缓存则返回504</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td>✔️</td>
<td></td>
</tr>
<tr>
<td style="text-align:center"><strong>no-transform</strong></td>
<td style="text-align:center">强制要求代理服务器不要对资源进行转换, 禁止代理服务器对 <code>Content-Encoding</code>, <code>Content-Range</code>, <code>Content-Type</code>字段的修改(因此代理的gzip压缩将不被允许)</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td>✔️</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<p>假设所请求资源于4月5日缓存, 且在4月12日过期.</p>
<p>当max-age 与 max-stale 和 min-fresh 同时使用时, 它们的设置相互之间独立生效, 最为保守的缓存策略总是有效. 这意味着, 如果max-age=10 days, max-stale=2 days, min-fresh=3 days, 那么:</p>
<ul>
<li>根据max-age的设置, 覆盖原缓存周期,  缓存资源将在4月15日失效(5+10=15);</li>
<li>根据max-stale的设置, 缓存过期后两天依然有效, 此时响应将返回110(Response is stale)状态码, 缓存资源将在4月14日失效(12+2=14);</li>
<li>根据min-fresh的设置, 至少要留有3天的新鲜期, 缓存资源将在4月9日失效(12-3=9);</li>
</ul>
<p>由于客户端总是采用最保守的缓存策略, 因此, 4月9日后, 对于该资源的请求将重新向服务器发起验证.</p>
<h3 id="Pragma"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#Pragma" class="headerlink" title="Pragma"></a><strong>Pragma</strong></h3><p>http1.0字段, 通常设置为<code>Pragma:no-cache</code>, 作用同<code>Cache-Control:no-cache</code>. 当一个no-cache请求发送给一个不遵循HTTP/1.1的服务器时, 客户端应该包含pragma指令. 为此, 勾选☑️ 上disable cache时, 浏览器自动带上了pragma字段. 如下:</p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache03.png" title="Pragma:no-cache" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache03.png" title="Pragma:no-cache"></a></p>
<h3 id="Expires"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#Expires" class="headerlink" title="Expires"></a><strong>Expires</strong></h3><pre><code class="http hljs has-numbering"><span class="hljs-attribute">Expires:Wed, 05 Apr 2017 00:55:35 GMT
</span></code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>即到期时间, 以服务器时间为参考系, 其优先级比 <code>Cache-Control:max-age</code> 低, 两者同时出现在响应头时, <code>Expires</code>将被后者覆盖. 如果<code>Expires</code>, <code>Cache-Control: max-age</code>, 或 <code>Cache-Control:s-maxage</code> 都没有在响应头中出现, 并且也没有其它缓存的设置, 那么浏览器默认会采用一个启发式的算法, 通常会取响应头的<code>Date_value - Last-Modified_value</code>值的10%作为缓存时间.</p>
<p>如下资源便采取了启发式缓存算法.</p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache06.png" title="启发式缓存生效" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache06.png" title="启发式缓存生效"></a></p>
<p>其缓存时间为 <code>(Date_value - Last-Modified_value) * 10%</code>, 计算如下:</p>
<pre><code class="js hljs javascript has-numbering"><span class="hljs-keyword">const</span> Date_value = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'Thu, 06 Apr 2017 01:30:56 GMT'</span>).getTime();
<span class="hljs-keyword">const</span> LastModified_value = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">'Thu, 01 Dec 2016 06:23:23 GMT'</span>).getTime();
<span class="hljs-keyword">const</span> cacheTime = (Date_value - LastModified_value) / <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> Expires_timestamp = Date_value + cacheTime;
<span class="hljs-keyword">const</span> Expires_value = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(Expires_timestamp);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Expires:'</span>, Expires_value); <span class="hljs-comment">// Expires: Tue Apr 18 2017 23:25:41 GMT+0800 (CST)</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul></pre>
<p>可见该资源将于2017年4月18日23点25分41秒过期, 尝试以下两步进行验证:</p>
<p>1) 试着把本地时间修改为2017年4月18日23点25分40秒, 迅速刷新页面, 发现强缓存依然有效(依旧是<code>200 OK (from disk cache)</code>).</p>
<p>2) 然后又修改本地时间为2017年4月18日23点26分40秒(即往后拨1分钟), 刷新页面, 发现缓存已过期, 此时浏览器重新向服务器发起了验证, 且命中了304协商缓存, 如下所示.</p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache07.png" title="缓存过期, 重新发起验证, 命中304协商缓存" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache07.png" title="缓存过期, 重新发起验证, 命中304协商缓存"></a></p>
<p>3) 将本地时间恢复正常(即 2017-04-06 09:54:19). 刷新页面, 发现Date依然是4月18日, 如下所示.</p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache08.png" title="本地时间恢复正常, 缓存依然有效" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache08.png" title="本地时间恢复正常, 缓存依然有效"></a></p>
<p>从<code>⚠️ Provisional headers are shown</code> 和Date字段可以看出来, 浏览器并未发出请求, 缓存依然有效, 只不过此时Status Code显示为200 OK. (甚至我还专门打开了charles, 也没有发现该资源的任何请求, 可见这个200 OK多少有些误导人的意味)</p>
<p>可见, 启发式缓存算法采用的缓存时间可长可短, 因此对于常规资源, 建议明确设置缓存时间(如指定max-age 或 expires).</p>
<h3 id="ETag"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#ETag" class="headerlink" title="ETag"></a><strong>ETag</strong></h3><pre><code class="http hljs has-numbering"><span class="hljs-attribute">ETag:"fcb82312d92970bdf0d18a4eca08ebc7efede4fe"
</span></code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>实体标签, 服务器资源的唯一标识符, 浏览器可以根据ETag值缓存数据, 节省带宽. 如果资源已经改变, etag可以帮助防止同步更新资源的相互覆盖. ETag 优先级比 Last-Modified 高.</p>
<h3 id="If-Match"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#If-Match" class="headerlink" title="If-Match"></a><strong>If-Match</strong></h3><p>语法: <em>If-Match: ETag_value</em> 或者 <em>If-Match: ETag_value, ETag_value, …</em></p>
<p>缓存校验字段, 其值为上次收到的一个或多个<code>etag</code> 值. 常用于判断条件是否满足, 如下两种场景:</p>
<ul>
<li>对于 GET 或 HEAD 请求, 结合 Range 头字段, 它可以保证新范围的请求和前一个来自相同的源, 如果不匹配, 服务器将返回一个416(Range Not Satisfiable)状态码的响应.</li>
<li>对于 PUT 或者其他不安全的请求, <code>If-Match</code> 可用于阻止错误的更新操作, 如果不匹配, 服务器将返回一个412(Precondition Failed)状态码的响应.</li>
</ul>
<h3 id="If-None-Match"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#If-None-Match" class="headerlink" title="If-None-Match"></a><strong>If-None-Match</strong></h3><p>语法: <em>If-None-Match: ETag_value</em> 或者 <em>If-None-Match: ETag_value, ETag_value, …</em></p>
<p>缓存校验字段, 结合ETag字段, 常用于判断缓存资源是否有效, 优先级比<code>If-Modified-Since</code>高.</p>
<ul>
<li>对于 GET 或 HEAD 请求, 如果其etags列表均不匹配, 服务器将返回200状态码的响应, 反之, 将返回304(Not Modified)状态码的响应. 无论是200还是304响应, 都至少返回 <code>Cache-Control</code>, <code>Content-Location</code>, <code>Date</code>, <code>ETag</code>, <code>Expires</code>, and <code>Vary</code> 中之一的字段.</li>
<li>对于其他更新服务器资源的请求, 如果其etags列表匹配, 服务器将执行更新, 反之, 将返回412(Precondition Failed)状态码的响应.</li>
</ul>
<h3 id="Last-Modified"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#Last-Modified" class="headerlink" title="Last-Modified"></a><strong>Last-Modified</strong></h3><p>语法: <em>Last-Modified: 星期,日期 月份 年份 时:分:秒 GMT</em></p>
<pre><code class="http hljs has-numbering"><span class="hljs-attribute">Last-Modified</span>: Tue, 04 Apr 2017 10:01:15 GMT
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>用于标记请求资源的最后一次修改时间, 格式为GMT(格林尼治标准时间). 如可用 <code>new Date().toGMTString()</code>获取当前GMT时间. Last-Modified 是 ETag 的fallback机制, 优先级比 ETag 低, 且只能精确到秒, 因此不太适合短时间内频繁改动的资源. 不仅如此, 服务器端的静态资源, 通常需要编译打包, 可能出现资源内容没有改变, 而Last-Modified却改变的情况.</p>
<h3 id="If-Modified-Since"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#If-Modified-Since" class="headerlink" title="If-Modified-Since"></a><strong>If-Modified-Since</strong></h3><p>语法同上, 如:</p>
<pre><code class="http hljs has-numbering"><span class="hljs-attribute">If-Modified-Since</span>: Tue, 04 Apr 2017 10:12:27 GMT
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>缓存校验字段, 其值为上次响应头的Last-Modified值, 若与请求资源当前的Last-Modified值相同, 那么将返回304状态码的响应, 反之, 将返回200状态码响应.</p>
<h3 id="If-Unmodified-Since"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#If-Unmodified-Since" class="headerlink" title="If-Unmodified-Since"></a><strong>If-Unmodified-Since</strong></h3><p>缓存校验字段, 语法同上. 表示资源未修改则正常执行更新, 否则返回412(Precondition Failed)状态码的响应. 常用于如下两种场景:</p>
<ul>
<li>不安全的请求, 比如说使用post请求更新wiki文档, 文档未修改时才执行更新.</li>
<li>与 If-Range 字段同时使用时, 可以用来保证新的片段请求来自一个未修改的文档.</li>
</ul>
<h3 id="强缓存"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#%E5%BC%BA%E7%BC%93%E5%AD%98" class="headerlink" title="强缓存"></a><strong>强缓存</strong></h3><p>一旦资源命中强缓存, 浏览器便不会向服务器发送请求, 而是直接读取缓存. Chrome下的现象是 <code>200 OK (from disk cache)</code> 或者 <code>200 OK (from memory cache)</code>. 如下:</p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache01.png" title="200 OK (from disk cache)" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache01.png" title="200 OK (from disk cache)"></a></p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache02.png" title="200 OK (from memory cache)" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache02.png" title="200 OK (from memory cache)"></a></p>
<p>对于常规请求, 只要存在该资源的缓存, 且Cache-Control:max-age 或者expires没有过期, 那么就能命中强缓存.</p>
<h3 id="协商缓存"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" class="headerlink" title="协商缓存"></a><strong>协商缓存</strong></h3><p>缓存过期后, 继续请求该资源, 对于现代浏览器, 拥有如下两种做法:</p>
<ul>
<li>根据上次响应中的ETag_value, 自动往request header中添加<code>If-None-Match</code>字段. 服务器收到请求后, 拿<code>If-None-Match</code>字段的值与资源的<code>ETag</code>值进行比较, 若相同, 则命中协商缓存, 返回304响应.</li>
<li>根据上次响应中的Last-Modified_value, 自动往request header中添加<code>If-Modified-Since</code>字段. 服务器收到请求后, 拿<code>If-Modified-Since</code>字段的值与资源的<code>Last-Modified</code>值进行比较, 若相同, 则命中协商缓存, 返回304响应.</li>
</ul>
<p>以上, ETag优先级比Last-Modified高, 同时存在时, 前者覆盖后者. 下面通过实例来理解下强缓存和协商缓存.</p>
<p>如下忽略首次访问, 第二次通过 <code>If-Modified-Since</code> 命中了304协商缓存.</p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache04.png" title="304" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache04.png" title="304"></a></p>
<p>协商缓存的响应结果, 不仅验证了资源的有效性, 同时还更新了浏览器缓存. 主要更新内容如下:</p>
<pre><code class="http hljs has-numbering"><span class="hljs-attribute">Age:0
Cache-Control:max-age=600
Date</span>: Wed, 05 Apr 2017 13:09:36 GMT
<span class="hljs-attribute">Expires:Wed, 05 Apr 2017 00:55:35 GMT
</span></code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre>
<p><code>Age:0</code> 表示命中了代理服务器的缓存, age值为0表示代理服务器刚刚刷新了一次缓存.</p>
<p><code>Cache-Control:max-age=600</code> 覆盖 <code>Expires</code> 字段, 表示从Date_value, 即 <code>Wed, 05 Apr 2017 13:09:36 GMT</code> 起, 10分钟之后缓存过期. 因此10分钟之内访问, 将会命中强缓存, 如下所示:</p>
<p><a href="./浏览器缓存机制剖析 _ louis blog_files/http-cache05.png" title="200 from cache" rel="fancy-group" class="fancy-ctn fancybox"><img src="./浏览器缓存机制剖析 _ louis blog_files/http-cache05.png" title="200 from cache"></a></p>
<p>当然, 除了上述与缓存直接相关的字段外, http header中还包括如下间接相关的字段.</p>
<h3 id="Age"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#Age" class="headerlink" title="Age"></a><strong>Age</strong></h3><p>出现此字段, 表示命中代理服务器的缓存. 它指的是代理服务器对于请求资源的已缓存时间, 单位为秒. 如下:</p>
<pre><code class="http hljs has-numbering"><span class="hljs-attribute">Age:2383321
Date:Wed, 08 Mar 2017 16:12:42 GMT
</span></code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<p>以上指的是, 代理服务器在2017年3月8日16:12:42时向源服务器发起了对该资源的请求, 目前已缓存了该资源2383321秒.</p>
<h3 id="Date"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#Date" class="headerlink" title="Date"></a><strong>Date</strong></h3><p>指的是响应生成的时间. 请求经过代理服务器时, 返回的Date未必是最新的, 通常这个时候, 代理服务器将增加一个Age字段告知该资源已缓存了多久.</p>
<h3 id="Vary"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#Vary" class="headerlink" title="Vary"></a><strong>Vary</strong></h3><p>对于服务器而言, 资源文件可能不止一个版本, 比如说压缩和未压缩, 针对不同的客户端, 通常需要返回不同的资源版本. 比如说老式的浏览器可能不支持解压缩, 这个时候, 就需要返回一个未压缩的版本; 对于新的浏览器, 支持压缩, 返回一个压缩的版本, 有利于节省带宽, 提升体验. 那么怎么区分这个版本呢, 这个时候就需要Vary了.</p>
<p>服务器通过指定<code>Vary: Accept-Encoding</code>, 告知代理服务器, 对于这个资源, 需要缓存两个版本: 压缩和未压缩. 这样老式浏览器和新的浏览器, 通过代理, 就分别拿到了未压缩和压缩版本的资源, 避免了都拿同一个资源的尴尬.</p>
<pre><code class="http hljs has-numbering"><span class="hljs-attribute">Vary:Accept-Encoding,User-Agent
</span></code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>如上设置, 代理服务器将针对是否压缩和浏览器类型两个维度去缓存资源. 如此一来, 同一个url, 就能针对PC和Mobile返回不同的缓存内容.</p>
<h3 id="怎么让浏览器不缓存静态资源"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#%E6%80%8E%E4%B9%88%E8%AE%A9%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E7%BC%93%E5%AD%98%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90" class="headerlink" title="怎么让浏览器不缓存静态资源"></a><strong>怎么让浏览器不缓存静态资源</strong></h3><p>实际上, 工作中很多场景都需要避免浏览器缓存, 除了浏览器隐私模式, 请求时想要禁用缓存, 还可以设置请求头: <code>Cache-Control: no-cache, no-store, must-revalidate</code> .</p>
<p>当然, 还有一种常用做法: 即给请求的资源增加一个版本号, 如下:</p>
<pre><code class="html hljs xml has-numbering"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../css/style.css?version=1.8.9"</span>/&gt;</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>这样做的好处就是你可以自由控制什么时候加载最新的资源.</p>
<p>不仅如此, HTML也可以禁用缓存, 即在页面的\<head\>节点中加入\<meta\>标签, 代码如下:</meta\></head\></p>
<pre><code class="html hljs xml has-numbering"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Cache-Control"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"no-cache, no-store, must-revalidate"</span>/&gt;</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>上述虽能禁用缓存, 但只有部分浏览器支持, 而且由于代理不解析HTML文档, 故代理服务器也不支持这种方式.</p>
<h3 id="IE8的异常表现"><a href="http://louiszhai.github.io/2017/04/07/http-cache/#IE8%E7%9A%84%E5%BC%82%E5%B8%B8%E8%A1%A8%E7%8E%B0" class="headerlink" title="IE8的异常表现"></a><strong>IE8的异常表现</strong></h3><p>实际上, 上述缓存有关的规律, 并非所有浏览器都完全遵循. 比如说IE8.</p>
<p>资源缓存是否有效相关.</p>
<table>
<thead>
<tr>
<th style="text-align:center">浏览器</th>
<th style="text-align:center">前提</th>
<th style="text-align:center">操作</th>
<th style="text-align:center">表现</th>
<th style="text-align:center">正常表现</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IE8</td>
<td style="text-align:center">资源缓存有效</td>
<td style="text-align:center">新开一个窗口加载网页</td>
<td style="text-align:center">重新发送请求(返回200)</td>
<td style="text-align:center">展示缓存的页面</td>
</tr>
<tr>
<td style="text-align:center">IE8</td>
<td style="text-align:center">资源缓存失效</td>
<td style="text-align:center">原浏览器窗口中单击 Enter 按钮</td>
<td style="text-align:center">展示缓存的页面</td>
<td style="text-align:center">重新发送请求(返回200)</td>
</tr>
</tbody>
</table>
<p>Last-Modified / E-Tag 相关.</p>
<table>
<thead>
<tr>
<th style="text-align:center">浏览器</th>
<th style="text-align:center">前提</th>
<th style="text-align:center">操作</th>
<th style="text-align:center">表现</th>
<th style="text-align:center">正常表现</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IE8</td>
<td style="text-align:center">资源内容没有修改</td>
<td style="text-align:center">新开一个窗口加载网页</td>
<td style="text-align:center">浏览器重新发送请求(返回200)</td>
<td style="text-align:center">重新发送请求(返回304)</td>
</tr>
<tr>
<td style="text-align:center">IE8</td>
<td style="text-align:center">资源内容已修改</td>
<td style="text-align:center">原浏览器窗口中单击 Enter 按钮</td>
<td style="text-align:center">浏览器展示缓存的页面</td>
<td style="text-align:center">重新发送请求(返回200)</td>
</tr>
</tbody>
</table>
<hr>
<p>版权声明：转载需注明作者和出处。</p>
<p>本文作者：<a href="https://github.com/Louiszhai" target="_blank" rel="external">louis</a></p>
<p>本文链接：<a href="http://louiszhai.github.io/2017/04/07/http-cache/">http://louiszhai.github.io/2017/04/07/http-cache/</a></p>
<p>参考文章</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/framework/network-programming/cache-policy-interaction-maximum-age-and-maximum-staleness" target="_blank" rel="external">Cache Policy Interaction—Maximum Age and Maximum Staleness</a></li>
<li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html" target="_blank" rel="external">HTTP/1.1: Header Field Definitions</a></li>
<li><a href="http://stackoverflow.com/questions/1046966/whats-the-difference-between-cache-control-max-age-0-and-no-cache" target="_blank" rel="external">http - What’s the difference between Cache-Control: max-age=0 and no-cache? - Stack Overflow</a></li>
<li><a href="http://www.baitouwei.com/2016/04/20/App-%E7%BC%93%E5%AD%98%E6%96%B9%E6%A1%88%EF%BC%9AHttp-%E7%BC%93%E5%AD%98/" target="_blank" rel="external">App 缓存方案：Http 缓存 · baitouwei</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="external">Cache-Control - HTTP | MDN</a></li>
<li><a href="http://t.cn/RlcCvtg" target="_blank" rel="external">彻底弄懂 Http 缓存机制 基于缓存策略三要素分解法</a><script src="./浏览器缓存机制剖析 _ louis blog_files/raphael.min.js.下载"></script><script src="./浏览器缓存机制剖析 _ louis blog_files/flowchart.min.js.下载"></script><textarea id="flowchart-0-code" style="display: none">st=&gt;start: 发起请求|pass
e=&gt;end: 载入资源
c1=&gt;condition: 是否已缓存?
c2=&gt;condition: [过期策略]-
缓存是否过期?
c3=&gt;condition: 验证是否通过?
op1=&gt;operation: [协商策略]-
重新向服务器发起验证
op2=&gt;operation: 向服务器请求资源
op3=&gt;operation: 304响应
io1=&gt;inputoutput: [存储策略]-
响应内容存入缓存
io2=&gt;inputoutput: [存储策略]-
根据响应头更新缓存

st-&gt;c1
c1(yes,right)-&gt;c2
c1(no)-&gt;op2
c2(yes, right)-&gt;op1(right)-&gt;c3
c2(no)-&gt;e
c3(yes, right)-&gt;op3-&gt;io2-&gt;e
c3(no)-&gt;op2-&gt;io1-&gt;e</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":1,"line-length":50,"text-margin":10,"font-size":12,"maxWidth":3,"symbols":{"start":{"fill":"#B5CA92","element-color":"green"},"condition":{"fill":"#58C4A3","yes-text":"是","no-text":"否"},"operation":{"fill":"#F1D5A6"},"inputoutput":{"fill":"#C59E63"},"end":{"fill":"#92A8CD"}}}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script></li>
</ul>

      
    </div>
    
  </div>
  
  
    <!-- -- 添加捐赠图标 ---->
<div class="post-donate">
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏"></a>
        <span class="donate_txt">
           ↑<br>
       支持一杯咖啡吧！
        </span>
      </div>  
  <div id="donate_guide" class="donate_bar center hidden">
    <!-- 支付宝打赏图案 -->
    <img src="./浏览器缓存机制剖析 _ louis blog_files/alipay.gif" alt="支付宝打赏"> 
    <!-- 微信打赏图案 -->
    <img src="./浏览器缓存机制剖析 _ louis blog_files/weixin.gif" alt="微信打赏">  
    </div>
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function(){
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }
  </script>
</div>
<!-- -- 添加捐赠图标 ---->
  

  
    
<nav id="article-nav">
  
    <a href="http://louiszhai.github.io/2017/04/19/hmr/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          webpack与browser-sync热更新原理深度讲解
        
      </div>
    </a>
  
  
    <a href="http://louiszhai.github.io/2017/03/12/promise/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Promise使用手册</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="./浏览器缓存机制剖析 _ louis blog_files/jia.js.下载" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>










  <style>
/*
    Name:     Kimbie (light)
    Author:   Jan T. Sott
    License:  Creative Commons Attribution-ShareAlike 4.0 Unported License
    URL:      https://github.com/idleberg/Kimbie-highlight.js
*/

/* Kimbie Comment */
.hljs-comment,
.hljs-quote {
  color: #a57a4c;
}

/* Kimbie Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-meta {
  color: #dc3958;
}

/* Kimbie Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-deletion,
.hljs-link {
  color: #f79a32;
}

/* Kimbie Yellow */
.hljs-title,
.hljs-section,
.hljs-attribute {
  color: #f06431;
}

/* Kimbie Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
  color: #889b4a;
}

/* Kimbie Purple */
.hljs-keyword,
.hljs-selector-tag,
.hljs-function {
  color: #98676a;
}

.hljs {
  display: block;
  overflow-x: auto;
  /*background: #fbebd4;*/
  color: #84613d;
  padding: 0.5em;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
</style>
  <script src="./浏览器缓存机制剖析 _ louis blog_files/highlight.min.js.下载"></script>
  <script>
    // hljs.initHighlightingOnLoad();
    [].slice.call(document.querySelectorAll('pre code')).forEach(function(block, i) {
      hljs.highlightBlock(block);
      var lines = block.innerText.split('\n').length - 1;
      var ul = document.createElement('ul');
      ul.className = 'pre-numbering';
      block.className += ' has-numbering';
      block.parentNode.appendChild(ul);
      for(i=1;i<=lines;i++){
        var li = document.createElement('li');
        li.innerText = i;
        ul.appendChild(li);
      }
    });
  </script>
</div>
        <link rel="stylesheet" href="./浏览器缓存机制剖析 _ louis blog_files/content.css" type="text/css">
<footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <img src="./浏览器缓存机制剖析 _ louis blog_files/top_arrow.png" class="top_arrow" id="top_arrow" style="display: inline;">
    	<div class="footer-left">
    		© 2019 路易斯

        <span style="position:relative;top:2px" id="cnzz_stat_icon_1256923583"><a href="https://www.cnzz.com/stat/website.php?web_id=1256923583" target="_blank" title="站长统计"><img border="0" hspace="0" vspace="0" src="./浏览器缓存机制剖析 _ louis blog_files/pic.gif"></a></span>
        <script type="text/javascript">
          var s = document.createElement('script');
          var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
          s.src = cnzz_protocol + "s11.cnzz.com/z_stat.php?id=1256923583&show=pic";
          document.body.appendChild(s);
        </script>

    	</div>
      	<div class="footer-right">
      		<a href="https://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
<script type="text/javascript">
  //swifty
  /*(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','4AmBuvmx4Cy-3hvyxeh8','2.0.0');*/
</script>
    </div>
    
  <link rel="stylesheet" href="./浏览器缓存机制剖析 _ louis blog_files/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="./浏览器缓存机制剖析 _ louis blog_files/jquery-1.9.1.min.js.下载"></script>
<script src="./浏览器缓存机制剖析 _ louis blog_files/main.js.下载"></script>
<script src="./浏览器缓存机制剖析 _ louis blog_files/content.js.下载"></script>







</div><i title="Raphaël Colour Picker" style="display: none; color: green;"></i><script src="./浏览器缓存机制剖析 _ louis blog_files/z_stat.php"></script>
<script src="./浏览器缓存机制剖析 _ louis blog_files/screenfull.js.下载"></script>
<a href="https://github.com/Louiszhai" style="position: fixed; top: 0; right: 0; border: 0;z-index:9999"><img source="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" src="./浏览器缓存机制剖析 _ louis blog_files/fork_me_on_github.png" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>

<div id="viewer" class="hide"><div id="viewer-box" style="height: 10304px;">		<div class="viewer-box-l">			<div class="viewer-box-wrap"><span class="viewer-title">友情链接</span><div class="viewer-div friends" id="js-mobile-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.zhangxinxu.com/wordpress/category/js/">张鑫旭-鑫空间-鑫生活</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://evanyou.me/">尤雨溪主页</a>
			        
			        </div><span class="viewer-title">标签</span><div class="viewer-div tagcloud" id="js-mobile-tagcloud">
						<a href="http://louiszhai.github.io/tags/CSS/" style="font-size: 12px;" class="color4">CSS</a> <a href="http://louiszhai.github.io/tags/JavaScript/" style="font-size: 12px;" class="color1">JavaScript</a> <a href="http://louiszhai.github.io/tags/JavaScript-Canvas/" style="font-size: 12px;" class="color3">JavaScript Canvas</a> <a href="http://louiszhai.github.io/tags/JavaScript-Chrome-Extension/" style="font-size: 12px;" class="color3">JavaScript Chrome-Extension</a> <a href="http://louiszhai.github.io/tags/Tool/" style="font-size: 12px;" class="color5">Tool</a> <a href="http://louiszhai.github.io/tags/Web/" style="font-size: 12px;" class="color4">Web</a> <a href="http://louiszhai.github.io/tags/XSS/" style="font-size: 12px;" class="color4">XSS</a> <a href="http://louiszhai.github.io/tags/css/" style="font-size: 12px;" class="color4">css</a> <a href="http://louiszhai.github.io/tags/javascript/" style="font-size: 12px;" class="color1">javascript</a>
					</div></div>		</div>		<div class="viewer-box-r"></div>		</div></div><div id="viewer" class="hide"><div id="viewer-box">		<div class="viewer-box-l">			<div class="viewer-box-wrap"><span class="viewer-title">友情链接</span><div class="viewer-div friends" id="js-mobile-friends"></div><span class="viewer-title">标签</span><div class="viewer-div tagcloud" id="js-mobile-tagcloud"></div></div>		</div>		<div class="viewer-box-r"></div>		</div></div></body></html>